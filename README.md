# Optical-Prediction-Neural-Network
Optical Data Prediction Tool
# General Description

Optical predictions (Emissivity and Reflectivity) based on inputs from finite difference time domain (FDTD) simulations. The inputs of the neural network have a geometric component (X, Z, substrate thickness, and Aspect Ratio (AR)), a component that depends on the plane wave source used in the simulation (linearly spaced wavelength points from a min and max simulation injection wavelength), and material properties defined by the complex refractive index (n and k). 

# Background -- Simulations
FDTD Simulations are Finite Element Model (FEM) style simulations, where a mesh is applied over an area and equations are solved over the domain. In this case, the solutions are of Maxwell's equations for electromagnetic radiation, and the solutions to these equations over the mesh allow us to compute optical properties for the simulated structure/geometry such as the reflectivity, transmissivity, and the emissivity. For our simulations, we simulate pyramids on a substrate in 2-D (i.e, triangles on a rectangular substrate) with periodic boundary conditions. This simulation setup predicts the optical properties for a triangular unit cell that infinitely extends along the x-axis in both directions (the y-axis, or 3rd dimension, is not considered for these simulations). The inputs we use are as follows: X span of the pyramid, Z span of the pyramid, thickness of the underlying substrate, and the wavelength (min/max) of the injected wave source into the simulation. 

For all material simulations, X/Z spans are selected from a randomly generated matrix of predefined values that range from a minimum value of ~0 to maximum of ~10 microns. 

The substrate thickness and wavelength properties depend on the selected material. For metals, the max/min values for the substrate thickness are 5/1 microns respectively. For non-metals, it is 100/5. Some select materials we use 40/1. These are somewhat arbitrarily defined, but generally rely on the material data as defined by the complex refractive index for the material and a knowledge of what materials are transmissive. Metals have minimal transmission due to a high extinction coefficient (k) value that limits tranmission thorugh the medium. Thus, simuating a thick substrate (> 5 um) would be a waste of simulation time as most metals need much less than 1 um to have a tranmission that is ~ 0 throughout the electromagnetic spectrum. Some metals/non-metals are more transmissive, so we define the max/min to capture the full range of tranmissivity behavior for the given material. Some materials do not require a large range substrate thickness range to capture the full range of behavior. This logic is also true for the wavelength range. We chose minimum and maxium values based on the expected behavior of the material. For transmissive materials such as PDMS (a polymer) simulating in the visible light spectrum (~300 - 800 nm) is useless as the material is tranmssive and the added range only serves to increase simulation time. For each material, we have a predefined min/max wavelength starting/ending point. From there, the simulation creates a linearly spaced vector of wavelengths to be simulated over. 

The simulation output (emissivity, reflectivity) match the wavelength points simulated one-for-one. From a mathmatical prospective, we are asking the simulation to simulate the equations across the mesh at particular frequencies, and each frequency point has a solution for the power transmitted through the domain and reflected from the domain (tranmission/reflection respectively). According to Kirchhoff's Law, The emission is the difference between the reflectivity and transmission. I.e, the power that is not tranmissed or reflected is the emitted power. These values occur from 0 - 1 (ratios of input to output), and are defined as the emissivity, reflectivity, and transmissivity of the domain. More details can be found here: 

https://support.lumerical.com/hc/en-us/articles/360042089573-Reflection-and-transmission-calculations-using-a-planewave
https://support.lumerical.com/hc/en-us/articles/360042706493-Thermal-emission-from-a-micro-hole-array
https://doi.org/10.1364/OE.14.008785

At each frequency point of the solution, the material properties have to be considered for the simulation to work. For optical simulations, the permittivity/refractive index are how materials are differentiated from one another and what the simualtion runs on. The simulation draws from a library of material data; we add to the material library for materials that do not exist or require refinement for our purposes. The data we use and import is based on literature values of n,k (refractive index) values from experimental measurements. For each frequency point of solution there is a matching n and k value used in the simulation. It should be noted that a material model is constructed (i.e, a curve-fit) based on existing literature values for frequency/wavelength points that do not match the literature values precisely. 

Examples of n,k complex refractive index data that we draw upon can be found here for several example materials: 
Silver:  https://refractiveindex.info/?shelf=main&book=Ag&page=Yang
Aluminum: https://refractiveindex.info/?shelf=main&book=Al&page=Ordal

# Understanding the Datafiles Included
Excel Datafiles show an annotated version of the data, with X, Z, AR, t_sub, the linearly spaced wavelength points, and n/k values that are linearly spaced corresponding to the wavelength point (i.e, if wavelength point #2 is at 1 um, then n/k #2 will be material data at 1 um as well). All data shown for the inputs is already normalized between 0 and 1. 

The .mat files included also have the normalized data but without the annotations. Calls to this data are done in the .py files already, so minimial work is required if you want to build and explore a new model. 

# Notes on the Neural Network Files
The Neural Network .py file is comprehensive code that includes optimizaiton methods for the neural network, ways to run and build new neural networks for the dataset. The preincluded model (Iter 15, or Model_V3_Ni15FD) is an already optimized and generated model that can be used to process new data or to reprocess old data. To load and use this dataset, simply make sure that the "Model Run" option is set to "No" and that the "Iter Number" is set to 15. If you do want to run new models, simply change the Iter Number and set "Model Run" to "Yes". Hyperparameter optimizaiton is also included and can be turned on, but this is not recommended due to the time involved. 

The CNN File takes in a 256 x 256 image of the 10 um x 10 um simulation domain and makes predictions based on the binary image input for what the simulation output should be. The included .mat file has a 256 x 256 image for each geometry simulated as well as the emissivity/reflectivity outputs. This file has a similar execution style to the Neural Network .py file, simply change the "Model Run", "HyperP" and other parameters according to what you want to do. 
